# [\#1335 PR](https://github.com/ethereum/solidity/pull/1335) `closed`: [#1172] Mutation testing support for Solidity

#### <img src="https://avatars.githubusercontent.com/u/4614623?u=7ad7c52b09731a99d93723c6bc4891244b72d1eb&v=4" width="50">[ameten](https://github.com/ameten) opened issue at [2016-11-07 18:14](https://github.com/ethereum/solidity/pull/1335):



#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2016-11-08 10:55](https://github.com/ethereum/solidity/pull/1335#issuecomment-259106812):

Thanks for the pull request! Unfortunately, this is a quite invasive change and I'm not sure how to best integrate it into the compiler.

#### <img src="https://avatars.githubusercontent.com/u/4614623?u=7ad7c52b09731a99d93723c6bc4891244b72d1eb&v=4" width="50">[ameten](https://github.com/ameten) commented at [2016-11-08 13:32](https://github.com/ethereum/solidity/pull/1335#issuecomment-259136838):

@chriseth, yes, the change looks big, but the options other than "mutate" work as before, and it is possible to review per commit. Each commit should compile and keep compiler functional.

#### <img src="https://avatars.githubusercontent.com/u/4614623?u=7ad7c52b09731a99d93723c6bc4891244b72d1eb&v=4" width="50">[ameten](https://github.com/ameten) commented at [2016-11-10 16:36](https://github.com/ethereum/solidity/pull/1335#issuecomment-259739156):

@chriseth, no chance for mutations being intergrated?

#### <img src="https://avatars.githubusercontent.com/u/20340?v=4" width="50">[axic](https://github.com/axic) commented at [2016-11-11 00:11](https://github.com/ethereum/solidity/pull/1335#issuecomment-259845929):

@ameten I wonder how possible would it be doing this based on the JSON AST output?

#### <img src="https://avatars.githubusercontent.com/u/4614623?u=7ad7c52b09731a99d93723c6bc4891244b72d1eb&v=4" width="50">[ameten](https://github.com/ameten) commented at [2016-11-11 07:32](https://github.com/ethereum/solidity/pull/1335#issuecomment-259898582):

@axis, do you mean to create another utility totally separated from solc?

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2016-11-14 21:05](https://github.com/ethereum/solidity/pull/1335#issuecomment-260462439):

Yes, I think this is what he means. It would be great if this could be done in a more "plugin-ish" way.

#### <img src="https://avatars.githubusercontent.com/u/20340?v=4" width="50">[axic](https://github.com/axic) commented at [2016-11-14 21:06](https://github.com/ethereum/solidity/pull/1335#issuecomment-260462473):

@ameten trying to understand if the outputs generated by Solidity (the JSON AST for example) would enable writing this tool outside of the compiler

#### <img src="https://avatars.githubusercontent.com/u/4614623?u=7ad7c52b09731a99d93723c6bc4891244b72d1eb&v=4" width="50">[ameten](https://github.com/ameten) commented at [2016-11-15 22:47](https://github.com/ethereum/solidity/pull/1335#issuecomment-260795151):

@axic, yes, JSON AST can be used for mutation assuming that "src" defines the location of an operator. It is a possible approach but it has its drawbacks, though.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2016-12-11 15:51](https://github.com/ethereum/solidity/pull/1335#issuecomment-266289496):

I'm sorry, I know this was quite some work, but I have to close this now. If you want to talk about how te integrate these changes in another way, please don't hesitate to schedule a meeting.

#### <img src="https://avatars.githubusercontent.com/u/22255740?u=daa85104243d4b5fd7a9673e9c30106a0206c23f&v=4" width="50">[pieterhartel](https://github.com/pieterhartel) commented at [2019-07-21 07:21](https://github.com/ethereum/solidity/pull/1335#issuecomment-513530275):

What is the status of the mutation project for solidity? 
- Is there a prototype tool?
- documentation?
- plans?

I am asking because I have written a mutation tool and would like to share ideas and results.

--pieter

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2019-08-01 11:19](https://github.com/ethereum/solidity/pull/1335#issuecomment-517240840):

We plan to add ast-import to the compiler, i.e. compile bytecode starting from an AST instead of starting from source code. That's all we have and plan. Please share your ideas and results! Maybe you could open a new issue to discuss? Maybe the discussion would also be better suited with some external testing tool.

#### <img src="https://avatars.githubusercontent.com/u/22255740?u=daa85104243d4b5fd7a9673e9c30106a0206c23f&v=4" width="50">[pieterhartel](https://github.com/pieterhartel) commented at [2019-08-03 13:28](https://github.com/ethereum/solidity/pull/1335#issuecomment-517924773):

I'm not sure how to open a new issue, but I'm happy to share some issues (below). All of these apply to the LegacyAST. I have found work-arounds for all of the issues, but the resulting code is not very pretty.

1.	The program text is assumed to be a long string and the src property of legacyAST nodes contains the beginning and end position of the substring that corresponds to the node. This makes it difficult to transform a program, because where would one put new text?
2.	Semantic information is largely missing. For example whether a variable is used as an L-value, or whether an expression is a rational expression.
3.	The legacyAST really only works for ASCII, and not for UTF8.
4.	Predefined identifiers are not included in the AST. Since these vary, depending on the compiler version this is not convenient.
5.	Comments are hidden in the src property of legacyAST nodes, hence it is not feasible to use the legacyAST for a comment stripper. 
6.	Older versions of Solidity may generate incomplete legacyAST. For example some attributes do not have the scope property.
7.	The src property of some legacyAST nodes (e.g. return) contains a trailing semicolon, but this is not done consistently.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2019-08-19 07:52](https://github.com/ethereum/solidity/pull/1335#issuecomment-522455258):

Sorry for the late reply, let me answer on your individual points.

1. this is indeed a problem for us, but I think @djudjuu is working on a solution.
2. is this also the case for the current AST format? Can you maybe elaborate in a separate issue? https://github.com/ethereum/solidity/issues/new/choose
3. Same as above
4. I don't really have a solution to that.
5. A comment stripper should be a very easy to implement separate tool, isn't it?
6. Again, no solution to that.
7. Can you open a new issue with some example code, please?

#### <img src="https://avatars.githubusercontent.com/u/9882716?v=4" width="50">[djudjuu](https://github.com/djudjuu) commented at [2019-08-27 14:37](https://github.com/ethereum/solidity/pull/1335#issuecomment-525331199):

@pieterhartel 

I am working on the importAST feaure in [this](https://github.com/ethereum/solidity/pull/7153) PR.
I think it is in a good-enough state to play aorund with,  as it works for most simple contracts (imported contracts and inline-assembly still cause trouble). I'd be glad to help you out if you have questions.

##### re: legacyAST vs compactAST
 If you haven't yet, I'd recommend that you have a look at that format. It is a lot more readable, and also complete for all kinds of programs. Also, the '''importAST''' function will only be available for the new version of the AST.
You get the new one like this: 
> solc --combined-json ast,compact-format --pretty-json <path2contract>

##### re: comment stripper
in the compact AST, comments are in their own "documentation" field, so a stripper should be easy to do.

#### <img src="https://avatars.githubusercontent.com/u/22255740?u=daa85104243d4b5fd7a9673e9c30106a0206c23f&v=4" width="50">[pieterhartel](https://github.com/pieterhartel) commented at [2019-08-31 15:14](https://github.com/ethereum/solidity/pull/1335#issuecomment-526838365):

@chriseth @djudjuu Thanks for your efforts on compact AST import.

May I suggest to make a clear difference between a _minimal_ set of properties that the compiler requires on AST input and a _maximal_ set of properties that the compiler produces as AST output? A program transformation tool would then be able to use the rich output to generate new code, without actually having to do any analysis on the generated code, because the compiler can do this better. It would be convenient if the rich output could easily be stripped.

I will let you know when the paper on our mutation tool is finished. Our current tool works only on the legacy AST, so we will have to rewrite it for the compact AST.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2019-09-03 10:27](https://github.com/ethereum/solidity/pull/1335#issuecomment-527400546):

Yep, that is the idea, export happens after analysis, but import re-starts the compiler just after parsing, i.e. before analysis, and it ignores any analysis data present in the import.


-------------------------------------------------------------------------------



[Export of Github issue for [ethereum/solidity](https://github.com/ethereum/solidity). Generated on 2024.12.15 at 06:45:24.]
