# [\#7536 Issue](https://github.com/ethereum/solidity/issues/7536) `closed`: Function selector is truncated to the last complete byte if datasize in bits isn’t dividable by 8 (the size of a byte).
**Labels**: `waiting for more input`


#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) opened issue at [2019-10-13 15:31](https://github.com/ethereum/solidity/issues/7536):

Last condition is number of bytes is above 4.
Example :

    0x10d0ffdd0000000000000000000000000000000000000000000e8ef1e96ae38
becomes :

    0x10d0ffd

And when looking at the function selector, it checks against `0x10d0ffda` whereas the last 4 bits of the function selector inside `ᴄᴀʟʟᴅᴀᴛᴀ` are truncated which makes it doesn’t finds any functions matching this selector which makes the payable function is used instead.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2019-10-15 12:03](https://github.com/ethereum/solidity/issues/7536#issuecomment-542178049):

Thanks for your bug report! Could you please provide the source code of a contract that has this behaviour and the compiler version and settings used (if that makes a difference)? I am assuming that you mean that the dispatch routine generated by the compiler does not work properly if specific calldata is sent to the smart contract. Is that correct?

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2019-10-15 22:03](https://github.com/ethereum/solidity/issues/7536#issuecomment-542424359):

@chriseth : unfortunately, no because this is [vendor hidden](https://etherscan.io/address/0x61edcdf5bb737adffe5043706e7c5bb1f1a56eea#code). I mean it did happen while reverse‑engineering the contract.

I can confirm it exhibits the ᴇᴄrecoverMalformedInput solidity compiler bug, so it shouldn’t be about a recent version.  
As a standalone person, I doubt Gemini would accept handing over their source code or even compiler version if the request comes from me.

But yes, otherwise, you’re correct that the dispatch routine doesn’t work on input which isn’t dividable by the size of a byte because of the division applied to truncate `ᴄᴀʟʟᴅᴀᴛᴀ` to the selector. Perhaps recent compiler also show this behavior, but this has to be tested.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2019-10-16 07:16](https://github.com/ethereum/solidity/issues/7536#issuecomment-542559074):

I could not find the selector you mentioned in the bytecode of the linked contract. The dispatch routine seems to always compare against a 4 byte value and also the `PUSH1 0xe0
PUSH1 0x02
EXP
PUSH1 0x00
CALLDATALOAD
DIV` part seems correct.

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2019-10-16 19:48](https://github.com/ethereum/solidity/issues/7536#issuecomment-542862547):

@chriseth : oh sorry. Wrong contract. [Indeed](https://etherscan.io/address/0xb3775fb83f7d12a36e0475abdd1fca35c091efbe#code).

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2019-10-17 09:24](https://github.com/ethereum/solidity/issues/7536#issuecomment-543088301):

In that contract, I can only see a check against `0x10d0ffdd`. Can you please describe the bug in more detail? Which component do you think is affected and how did you encounter the bug? I currently cannot imagine how four bits could be truncated during execution.

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2019-10-17 22:05](https://github.com/ethereum/solidity/issues/7536#issuecomment-543381266):

@chriseth : oh yes. Sorry. that’s not the input I used. I edited the original comment.

#### <img src="https://avatars.githubusercontent.com/u/20012009?u=61e903cf16bc5f3353db1d571401e2e71b6f61ed&v=4" width="50">[erak](https://github.com/erak) commented at [2019-10-28 16:12](https://github.com/ethereum/solidity/issues/7536#issuecomment-547022120):

@ytrezq Looking at the contract you mentioned I can't find the signature (even less bytes) at all. Just to wrap up: your bug report says that in this contract here: https://etherscan.io/address/0xb3775fb83f7d12a36e0475abdd1fca35c091efbe#code, you'd assume a check against `0x10d0ffdd`, which is `0x10d0ffda` in your case?

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2019-10-29 09:27](https://github.com/ethereum/solidity/issues/7536#issuecomment-547331138):

@erak : `0x10d0ffdd` is `calculateTokensReceived(uint256 _ethereumToSpend)`. And the point is truncation isn’t up to a full byte.

I suppose all was said with that comment.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2020-01-15 10:08](https://github.com/ethereum/solidity/issues/7536#issuecomment-574588832):

I still can see no mention of `0x10dffd` or `0x10dffda` in the linked bytecode. To investigate this further, we need actual example code that triggers this behaviour.

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2020-01-16 02:55](https://github.com/ethereum/solidity/issues/7536#issuecomment-574958186):

@chriseth this doesn t dépends on a specific code and works on all selectors anyway.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2020-01-16 08:41](https://github.com/ethereum/solidity/issues/7536#issuecomment-575044892):

@ytrezq we are still struggling with reproducing this issue. Everything is working fine for us. Can you please describe again what you are doing? Maybe the error is not in the compiler but in the way the calldata is formatted by the library you are using?

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-01-16 09:25](https://github.com/ethereum/solidity/issues/7536#issuecomment-575061230):

Haha, I think I know what is happening:
If you split up the calldata from the OP into blocks of 4 bytes you get:
```
 10d0ffd
d0000000
00000000
00000000
00000000
00000000
0000e8ef
1e96ae38
```

In short: you're missing a zero :-).

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-01-16 09:27](https://github.com/ethereum/solidity/issues/7536#issuecomment-575061866):

So if you use
```
0x10d0ffdd00000000000000000000000000000000000000000000e8ef1e96ae38
```
instead of
```
0x10d0ffdd0000000000000000000000000000000000000000000e8ef1e96ae38
```
that should fix your issue.

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2020-01-16 09:40](https://github.com/ethereum/solidity/issues/7536#issuecomment-575066963):

@ekpyron correct, but the function selector is still `10d0ffdd` (I mean the fu data is still at the correct place in the selector) so it should call the function.
This is because solidity performs a division on input data in order to extract the selector. But in the case the length doesn t end on a byte, there s truncation.

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-01-16 09:47](https://github.com/ethereum/solidity/issues/7536#issuecomment-575070445):

@ytrezq Here it very much depends on what tool you use to parse this hex string and use it as calldata. To me it seems like that tool parses the hex string as 256-bit integer and then stores it as big endian. So the first four bytes will end up being ``010d0ffd``, which is *not* the correct signature.

Which tools *do* you use for that? To me it seems that this is rather an issue with the tooling than with the solidity compiler.

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2020-01-16 09:50](https://github.com/ethereum/solidity/issues/7536#issuecomment-575071820):

I used the remix debugger of etherscan.
For me I thought the ethereum vm behave the same way.

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-01-16 09:52](https://github.com/ethereum/solidity/issues/7536#issuecomment-575072209):

I'm pretty sure that the division is correct, but that on your input the etherscan debugger will pass ``010d0ffd`` as the first four bytes of calldata and **not** ``10d0ffdd``.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2020-01-16 09:58](https://github.com/ethereum/solidity/issues/7536#issuecomment-575074971):

Some tools also silently prefix a `0` if the number of hex digits is odd.

#### <img src="https://avatars.githubusercontent.com/u/3824869?u=819b3aeb36ee7984a3346a2d8a05bf0d664fed4a&v=4" width="50">[ytrezq](https://github.com/ytrezq) commented at [2020-01-16 10:07](https://github.com/ethereum/solidity/issues/7536#issuecomment-575078279):

@chriseth but nothing is prefixed on etherscan.
I just saw `0x10d0ffd` on the stack instead of `0x10d0ffdd` assuming the real vm behave the same way.

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2020-01-16 10:23](https://github.com/ethereum/solidity/issues/7536#issuecomment-575085279):

@ytrezq then let's try to find out where that stack entry came from. Do you have a transaction that shows the behaviour on etherscan?

#### <img src="https://avatars.githubusercontent.com/u/20340?v=4" width="50">[axic](https://github.com/axic) commented at [2020-05-05 10:51](https://github.com/ethereum/solidity/issues/7536#issuecomment-623985028):

I think this may be more of an issue for Remix. @ytrezq please open an issue on https://github.com/ethereum/remix-ide.

Please provide an example stack trace on Remix so we can reopen this and further discuss, if you think it is a problem in the compiler.


-------------------------------------------------------------------------------



[Export of Github issue for [ethereum/solidity](https://github.com/ethereum/solidity). Generated on 2024.12.15 at 06:45:24.]
