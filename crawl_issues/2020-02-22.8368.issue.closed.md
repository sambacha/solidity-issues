# [\#8368 Issue](https://github.com/ethereum/solidity/issues/8368) `closed`: ICE in CompilerContext::appendInlineAssembly()::(anonymous class)::operator()(const std::__cxx11::string &) [Invalid assembly generated by code generator]
**Labels**: `bug :bug:`


#### <img src="https://avatars.githubusercontent.com/u/967816?u=e15de0869a62036529220016b1729fa1a6c18b5b&v=4" width="50">[agroce](https://github.com/agroce) opened issue at [2020-02-22 18:00](https://github.com/ethereum/solidity/issues/8368):

## Description

The attached contract (which does not work well just copied from here, but is shown to give an overview of what it looks like):

```solidity
pragma experimental ABIEncoderV2;contract C{struct S{int56 x;}bytes32 y=sha256("             ?                                                \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\");}
```

produces:

```
Internal compiler error during compilation:
/home/user/solidity/libsolidity/codegen/CompilerContext.cpp(405): Throw in function auto solidity::frontend::CompilerContext::appendInlineAssembly(const std::__cxx11::string &, const vector<std::__cxx11::string> &, const set<std::__cxx11::string> &, bool, const solidity::frontend::OptimiserSettings &)::(anonymous class)::operator()(const std::__cxx11::string &)
[invalidassembly.zip](https://github.com/ethereum/solidity/files/4239727/invalidassembly.zip)

 const
Dynamic exception type: boost::exception_detail::clone_impl<solidity::langutil::InternalCompilerError>
std::exception::what: Error parsing/analyzing inline assembly block:
Invalid assembly generated by code generator.
------------------ Input: -----------------
{
			function abi_decode_t_bytes32_fromMemory(offset, end) -> value {
				value := mload(offset)
				validator_revert_t_bytes32(value)
			}
		
			function abi_decode_tuple_t_bytes32_fromMemory(headStart, dataEnd) -> value0 {
				if slt(sub(dataEnd, headStart), 32) { revert(0, 0) }
				
				{
					let offset := 0
					value0 := abi_decode_t_bytes32_fromMemory(add(headStart, offset), dataEnd)
				}
				
			}
		
				function abi_encode_t_stringliteral_c816a9c7bea034f32c215b4d77b16e7e57af3a1d1fcc3653a2145c811f5b2fde_to_t_bytes_memory_ptr_nonPadded_inplace_fromStack(pos) -> end {
					pos := array_storeLengthForEncoding_t_bytes_memory_ptr_nonPadded_inplace_fromStack(pos, 115)
					
						mstore(add(pos, 0), 0x202020202020202020202001002020ff7f000020202020202020202020202020)
					
						mstore(add(pos, 32), "                                ")
					
						mstore(add(pos, 64), "   \\\\\\\\\\\\\\\\\\\\\\\\\\\\\")
					
						mstore(add(pos, 96), "\\\\\\\\\\\\\\\\\\\")
					
					end := add(pos, 115)
				}
			
			function abi_encode_tuple_packed_t_stringliteral_c816a9c7bea034f32c215b4d77b16e7e57af3a1d1fcc3653a2145c811f5b2fde__to_t_bytes_memory_ptr__nonPadded_inplace_fromStack(pos ) -> end {
				
					pos := abi_encode_t_stringliteral_c816a9c7bea034f32c215b4d77b16e7e57af3a1d1fcc3653a2145c811f5b2fde_to_t_bytes_memory_ptr_nonPadded_inplace_fromStack( pos)
				
				end := pos
			}
		
				function array_storeLengthForEncoding_t_bytes_memory_ptr_nonPadded_inplace_fromStack(pos, length) -> updated_pos {
					updated_pos := pos
				}
			
			function cleanup_t_bytes32(value) -> cleaned {
				cleaned := value
			}
		
			function validator_revert_t_bytes32(value) {
				if iszero(eq(value, cleanup_t_bytes32(value))) { revert(0, 0) }
			}
		}
------------------ Errors: ----------------
--CODEGEN--:24:28: Error: Literal or identifier expected.
						mstore(add(pos, 64), "   \\\\\\\\\\\\\\\\\\\\\\\\\\\\\")
						                     ^---------------------------------^
-------------------------------------------

[solidity::util::tag_comment*] = Error parsing/analyzing inline assembly block:
Invalid assembly generated by code generator.
------------------ Input: -----------------
{
			function abi_decode_t_bytes32_fromMemory(offset, end) -> value {
				value := mload(offset)
				validator_revert_t_bytes32(value)
			}
		
			function abi_decode_tuple_t_bytes32_fromMemory(headStart, dataEnd) -> value0 {
				if slt(sub(dataEnd, headStart), 32) { revert(0, 0) }
				
				{
					let offset := 0
					value0 := abi_decode_t_bytes32_fromMemory(add(headStart, offset), dataEnd)
				}
				
			}
		
				function abi_encode_t_stringliteral_c816a9c7bea034f32c215b4d77b16e7e57af3a1d1fcc3653a2145c811f5b2fde_to_t_bytes_memory_ptr_nonPadded_inplace_fromStack(pos) -> end {
					pos := array_storeLengthForEncoding_t_bytes_memory_ptr_nonPadded_inplace_fromStack(pos, 115)
					
						mstore(add(pos, 0), 0x202020202020202020202001002020ff7f000020202020202020202020202020)
					
						mstore(add(pos, 32), "                                ")
					
						mstore(add(pos, 64), "   \\\\\\\\\\\\\\\\\\\\\\\\\\\\\")
					
						mstore(add(pos, 96), "\\\\\\\\\\\\\\\\\\\")
					
					end := add(pos, 115)
				}
			
			function abi_encode_tuple_packed_t_stringliteral_c816a9c7bea034f32c215b4d77b16e7e57af3a1d1fcc3653a2145c811f5b2fde__to_t_bytes_memory_ptr__nonPadded_inplace_fromStack(pos ) -> end {
				
					pos := abi_encode_t_stringliteral_c816a9c7bea034f32c215b4d77b16e7e57af3a1d1fcc3653a2145c811f5b2fde_to_t_bytes_memory_ptr_nonPadded_inplace_fromStack( pos)
				
				end := pos
			}
		
				function array_storeLengthForEncoding_t_bytes_memory_ptr_nonPadded_inplace_fromStack(pos, length) -> updated_pos {
					updated_pos := pos
				}
			
			function cleanup_t_bytes32(value) -> cleaned {
				cleaned := value
			}
		
			function validator_revert_t_bytes32(value) {
				if iszero(eq(value, cleanup_t_bytes32(value))) { revert(0, 0) }
			}
		}
------------------ Errors: ----------------
--CODEGEN--:24:28: Error: Literal or identifier expected.
						mstore(add(pos, 64), "   \\\\\\\\\\\\\\\\\\\\\\\\\\\\\")
						                     ^---------------------------------^
-------------------------------------------


```

when compiled with solc (optimization not needed)

On master, using AFL fuzzing.  Another discovery using https://github.com/agroce/afl-compiler-fuzzer, again with more mutation operators

## Environment

- Compiler version:  0.6.3-develop.2020.2.10+commit.e8eb1f2d.Linux.clang
- Target EVM version (as per compiler settings): N/A
- Framework/IDE (e.g. Truffle or Remix): N/A
- EVM execution environment / backend / blockchain client: N/A
- Operating system: Ubuntu 18.04 in docker

## Steps to Reproduce

Above shows pretty clearly, I think.


#### <img src="https://avatars.githubusercontent.com/u/424752?u=2d50de05ec528b9b84f8b905a56e90669b0f8927&v=4" width="50">[Marenz](https://github.com/Marenz) commented at [2020-05-07 15:59](https://github.com/ethereum/solidity/issues/8368#issuecomment-625343593):

I was unable to reproduce this with the given compiler version and contract. Do I need to use any specific flags when compiling?

#### <img src="https://avatars.githubusercontent.com/u/967816?u=e15de0869a62036529220016b1729fa1a6c18b5b&v=4" width="50">[agroce](https://github.com/agroce) commented at [2020-05-07 16:06](https://github.com/ethereum/solidity/issues/8368#issuecomment-625347885):

Hmm.  Try adding --optimize, or solfuzzer?

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2020-05-07 16:08](https://github.com/ethereum/solidity/issues/8368#issuecomment-625349089):

It looks like the backslashes are not properly escaped and I would say this is still the case.

#### <img src="https://avatars.githubusercontent.com/u/967816?u=e15de0869a62036529220016b1729fa1a6c18b5b&v=4" width="50">[agroce](https://github.com/agroce) commented at [2020-05-07 16:15](https://github.com/ethereum/solidity/issues/8368#issuecomment-625353492):

I can reproduce on a more recent solc:

```
$ ~/solidity/build/solc/solc --version
solc, the solidity compiler commandline interface
Version: 0.6.7-develop.2020.4.20+commit.41ef1312.Linux.clang
```

Use the file https://github.com/agroce/afl-compiler-fuzzer/blob/master/example.sol

```
$ ~/solidity/build/solc/solc example.sol
```
...
```
Internal compiler error during compilation:
/home/user/solidity/libsolidity/codegen/CompilerContext.cpp(439): Throw in function auto solidity::frontend::CompilerContext::appendInlineAssembly(const std::__cxx11::string &, const vector<std::__cxx11::string> &, const set<std::__cxx11::string> &, bool, const solidity::frontend::OptimiserSettings &)::(anonymous class)::operator()(const std::__cxx11::string &) const
Dynamic exception type: boost::exception_detail::clone_impl<solidity::langutil::InternalCompilerError>
std::exception::what: Error parsing/analyzing inline assembly block:
Invalid assembly generated by code generator.
```

#### <img src="https://avatars.githubusercontent.com/u/424752?u=2d50de05ec528b9b84f8b905a56e90669b0f8927&v=4" width="50">[Marenz](https://github.com/Marenz) commented at [2020-05-07 16:52](https://github.com/ethereum/solidity/issues/8368#issuecomment-625373007):

Using your provided file I can reproduce it as well now. Thanks!

#### <img src="https://avatars.githubusercontent.com/u/2388185?v=4" width="50">[bshastry](https://github.com/bshastry) commented at [2020-05-11 21:58](https://github.com/ethereum/solidity/issues/8368#issuecomment-626987821):

Another test case for this issue if that helps

```
pragma experimental ABIEncoderV2;
contract C{function i()public{abi.encode(("\\"));}}
```


-------------------------------------------------------------------------------



[Export of Github issue for [ethereum/solidity](https://github.com/ethereum/solidity). Generated on 2024.12.15 at 06:45:24.]
