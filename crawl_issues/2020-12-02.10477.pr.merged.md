# [\#10477 PR](https://github.com/ethereum/solidity/pull/10477) `merged`: [SMTChecker] Move CHC counterexamples to primary location

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) opened issue at [2020-12-02 17:42](https://github.com/ethereum/solidity/pull/10477):

This especially enables testing CHC counterexamples. This is really needed now that they're becoming more complex.
Now we just need to review these updates :p

Depends on https://github.com/ethereum/solc-js/pull/506

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-02 18:04](https://github.com/ethereum/solidity/pull/10477#issuecomment-737399932):

I think we can merge this without checking the results, and then check them separately and open issues for buggy counterexamples.

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-03 07:35](https://github.com/ethereum/solidity/pull/10477#issuecomment-737723576):

1 nondeterminism case on Ubuntu
9 nondeterminism cases on OSX
The Ubuntu one we could just disable for now, as we did with other tests, but the OSX ones not sure...

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-07 17:22](https://github.com/ethereum/solidity/pull/10477#issuecomment-740060816):

@ekpyron @axic @chriseth We need to decide whether the counterexamples should be tested or not.
It would be nice to test them mostly to catch problems in the counterexamples caused by other features.
The downside is that they're a bit more nondeterministic than queries, as seen above.
Do we want to go for it or not?

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-12-07 17:36](https://github.com/ethereum/solidity/pull/10477#issuecomment-740068446):

> @ekpyron @axic @chriseth We need to decide whether the counterexamples should be tested or not.
> It would be nice to test them mostly to catch problems in the counterexamples caused by other features.
> The downside is that they're a bit more nondeterministic than queries, as seen above.
> Do we want to go for it or not?

At least I'd say your call - you're who primarily will need to deal with the nondeterminism :-). I'm pretty sure it will be at least somewhat annoying... What you could also consider as compromise would be having explicit support in ``SMTCheckerTest``, i.e. adding a test configuration option to filter them out or not on a per-test basis. Then you can test some stable ones to make sure the counterexample mechanism doesn't start reporting nonsense - but you can disable flaky ones... (while not having to remove the entire tests for it)

#### <img src="https://avatars.githubusercontent.com/u/9073706?v=4" width="50">[chriseth](https://github.com/chriseth) commented at [2020-12-07 17:44](https://github.com/ethereum/solidity/pull/10477#issuecomment-740072663):

I agree, we can add some mechanism so that running the tests in different environments still works.

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-07 22:13](https://github.com/ethereum/solidity/pull/10477#issuecomment-740212054):

Added an option `SMTIgnoreCex` to ignore SMTChecker counterexamples.
That was a good idea @ekpyron @chriseth 
Had to ignore a bunch of flaky ones, but the rest seems to work.
This also depends on https://github.com/ethereum/solc-js/pull/506

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-12-08 13:17](https://github.com/ethereum/solidity/pull/10477#issuecomment-740613514):

Ok, I see it's intentional, but I'm not sure I understand why... I would argue the test expectations should better not contain anything that's not actually being tested, so I'd cut them out.

> That's the thing, I would rather allow the test file to have expectations which are generated by whoever wrote the PR locally.

What's the value in that?

I think I'd be fine to do it that way in the end, but I'd be curious about the reasoning behind it :-).

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-08 14:46](https://github.com/ethereum/solidity/pull/10477#issuecomment-740663052):

For me the value is that when I write a PR and get counterexamples while running isoltest, I can still check the counterexample myself, even if CI doesn't.

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-12-08 14:50](https://github.com/ethereum/solidity/pull/10477#issuecomment-740665393):

> For me the value is that when I write a PR and get counterexamples while running isoltest, I can still check the counterexample myself, even if CI doesn't.

Yeah, ok... it might actually also make reviewing test cases easier to have counterexamples in them...
I'm still not entirely sure, because it still is weird to have them there, but untested, but I'm fine with it :-).

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-08 14:51](https://github.com/ethereum/solidity/pull/10477#issuecomment-740666208):

Also fine removing it, not a big deal to do it.

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-12-08 15:03](https://github.com/ethereum/solidity/pull/10477#issuecomment-740673470):

> Also fine removing it, not a big deal to do it.

Then throw some dice ;-). No really, as you like then!

#### <img src="https://avatars.githubusercontent.com/u/1347491?v=4" width="50">[ekpyron](https://github.com/ekpyron) commented at [2020-12-08 15:04](https://github.com/ethereum/solidity/pull/10477#issuecomment-740673924):

Or anyone else leaning either way?

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-08 15:08](https://github.com/ethereum/solidity/pull/10477#issuecomment-740676426):

Now I already removed them locally haha

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-08 15:26](https://github.com/ethereum/solidity/pull/10477#issuecomment-740687760):

I'll still need to change the solc-js branch after it gets merged there.

#### <img src="https://avatars.githubusercontent.com/u/504195?u=ce2facd14af9fd474ebff49f0d44891f56f7500f&v=4" width="50">[leonardoalt](https://github.com/leonardoalt) commented at [2020-12-09 19:29](https://github.com/ethereum/solidity/pull/10477#issuecomment-741997456):

> For the record: I didn't sanity-check the actual counterexamples :-). But fine to merge.

No one did. Here we just want to have them out. We have an issue to check the counterexamples themselves separately.


-------------------------------------------------------------------------------



[Export of Github issue for [ethereum/solidity](https://github.com/ethereum/solidity). Generated on 2024.12.15 at 06:45:24.]
