# [\#12422 Issue](https://github.com/ethereum/solidity/issues/12422) `closed`: Parallelize macOS build in CI
**Labels**: `build system :building_construction:`, `performance :racehorse:`, `good first issue`, `medium difficulty`


#### <img src="https://avatars.githubusercontent.com/u/137030?v=4" width="50">[cameel](https://github.com/cameel) opened issue at [2021-12-16 17:44](https://github.com/ethereum/solidity/issues/12422):

In https://github.com/ethereum/solidity/issues/11670#issuecomment-954297346 I discovered that our [macOS build](https://github.com/ethereum/solidity/blob/v0.8.10/.circleci/config.yml#L673-L707) job in CI takes ~20 min regardless of how many cores the machine has. Apparently the `-j` flag we put in `MAKEFLAGS` variable is getting ignored. I think that the build config generated by CMake on macOS is still `make`-based so I'm not sure why this is the case.

This needs to be investigated. Once we know how to parallelize it, we should adjust the number of threads/processes and machine resource class in CI for the best cost/benefit ratio.

#### <img src="https://avatars.githubusercontent.com/u/201236?u=efb457efc42d282fcc992c65d3c48a343cc49d27&v=4" width="50">[willianpaixao](https://github.com/willianpaixao) commented at [2022-01-14 20:08](https://github.com/ethereum/solidity/issues/12422#issuecomment-1013440753):

Hi @cameel, very interesting issue.

For over a decade I only saw the `-j` flag being used without a space as separator, eg, `-j4`, which raised my eyebrows. Maybe Ubuntu can understand that but MacOS can't. So I would remove the space and fire a pipeline to check.

That said, assuming this was not the problem, maybe we should try a different flag, here are the cmake equialent:

- [CMAKE_BUILD_PARALLEL_LEVEL](https://cmake.org/cmake/help/latest/envvar/CMAKE_BUILD_PARALLEL_LEVEL.html#envvar:CMAKE_BUILD_PARALLEL_LEVEL)
- [CMAKE_CXX_FLAGS](https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_FLAGS.html#variable:CMAKE_%3CLANG%3E_FLAGS)

Unfortunately I don't own a Mac that I can try it myself.

#### <img src="https://avatars.githubusercontent.com/u/137030?v=4" width="50">[cameel](https://github.com/cameel) commented at [2022-01-14 20:54](https://github.com/ethereum/solidity/issues/12422#issuecomment-1013467205):

That's a great point. Being used to the GNU tools it didn't even cross my mind but it could really be just that.

Honestly, I don't own a Mac either, I'm only ever using it in CI :) If you would like to try, it's as simple as tweaking our [config.yml](https://github.com/ethereum/solidity/blob/develop/.circleci/config.yml). If you create a PR it will run with your changed config.

If you do that you should log into CircleCI though and follow the project if you can because otherwise there are some limits on external PRs. Sometimes mac/windows jobs do not run at all. If that happens, usually a branch created by one of the project members also helps to trigger it so let me know.

#### <img src="https://avatars.githubusercontent.com/u/201236?u=efb457efc42d282fcc992c65d3c48a343cc49d27&v=4" width="50">[willianpaixao](https://github.com/willianpaixao) commented at [2022-01-14 21:16](https://github.com/ethereum/solidity/issues/12422#issuecomment-1013478923):

Well, I tried but apparently CircleCI wants some schmoney:

> Apologies! Your build didn’t run because you haven’t selected a plan that includes macOS yet. Please change to a Performance Plan. If you have any questions please feel free to contact support.

#### <img src="https://avatars.githubusercontent.com/u/137030?v=4" width="50">[cameel](https://github.com/cameel) commented at [2022-01-14 21:24](https://github.com/ethereum/solidity/issues/12422#issuecomment-1013483628):

OK, that's what was afraid would happen. Well, let me try it then.

#### <img src="https://avatars.githubusercontent.com/u/137030?v=4" width="50">[cameel](https://github.com/cameel) commented at [2022-01-14 21:34](https://github.com/ethereum/solidity/issues/12422#issuecomment-1013489151):

Here's a PR: #12536. Let's see if your theory is true :) Feel free to review.


-------------------------------------------------------------------------------



[Export of Github issue for [ethereum/solidity](https://github.com/ethereum/solidity). Generated on 2024.12.15 at 06:45:24.]
